<!-- Pagina history: mostra le azioni registrate nel mese selezionato. -->
<div class="page-center">
  <mat-card appearance="outlined" class="panel">
    <mat-card-header>
      <mat-card-title class="text-title">History</mat-card-title>
      <mat-card-subtitle class="text-subtitle">Registro azioni del periodo selezionato</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="content">
      <div class="period-toolbar">
        <a
          class="period-nav-link text-body-strong"
          role="button"
          tabindex="0"
          [class.is-disabled]="loading"
          (click)="!loading && previousMonth()"
          aria-label="Mese precedente"
        >
          &lt;
        </a>
        <span class="period-label text-body-strong">periodo:</span>
        <span class="period-value text-body">{{ month }}/{{ year }}</span>
        <a
          class="period-nav-link text-body-strong"
          role="button"
          tabindex="0"
          [class.is-disabled]="loading"
          (click)="!loading && nextMonth()"
          aria-label="Mese successivo"
        >
          &gt;
        </a>
      </div>

      <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
      <p *ngIf="message" class="error-text text-feedback-error">{{ message }}</p>

      <div class="table-wrapper" *ngIf="history.length > 0">
        <table mat-table [dataSource]="history" class="mat-elevation-z1 full-table">
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef class="text-label">Data</th>
            <td mat-cell *matCellDef="let item" class="text-body">{{ formatDate(item.created_at) }}</td>
          </ng-container>

          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef class="text-label">Utente</th>
            <td mat-cell *matCellDef="let item" class="text-body-strong">{{ item.username }}</td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef class="text-label">Azione</th>
            <td mat-cell *matCellDef="let item" class="text-body">{{ formatAction(item.action_type) }}</td>
          </ng-container>

          <ng-container matColumnDef="note">
            <th mat-header-cell *matHeaderCellDef class="text-label">Nota</th>
            <td mat-cell *matCellDef="let item" class="text-caption">{{ item.note || '-' }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>

      <p *ngIf="!loading && history.length === 0" class="hint-text text-caption">
        Nessuna azione trovata nel periodo selezionato.
      </p>
    </mat-card-content>
  </mat-card>
</div>
